<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoadbookMaker</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1 id="mainTitle">RoadbookMaker</h1>
                <div id="onlineModeActions" class="online-mode-actions"></div>
                <div class="theme-toggle-container">
                    <button id="themeToggleBtn" class="theme-toggle-btn" title="切换主题">
                        <span id="themeIcon">☀️</span>
                    </button>
                </div>
            </div>
            <!-- 日期备注便签 -->
            <div class="search-toolbar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="搜索地点...">
                    <select id="searchMethodSelect" class="btn" style="background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.15)); color: #fff; border: 2px solid rgba(255,255,255,0.5); padding: 0.6rem 1.2rem; border-radius: 25px; font-size: 0.9rem; font-weight: 600; cursor: pointer; margin-left: 0.5rem;">
                        <option value="auto">🗺️自动分配搜索</option>
                        <option value="photon">😀Photon搜索</option>
                        <option value="nominatim">😓Nominatim搜索</option>
                        <option value="overpass">😓Overpass搜索</option>
                        <option value="mapsearch">😀MapSearch搜索</option>
                        <option value="cnsearch">🤩CNSearch搜索</option>
                        <option value="tiansearch">🤩TianSearch搜索</option>
                    </select>
                    <!-- 搜索结果下拉框 -->
                    <div id="searchResults" class="search-results" style="display: none;">
                        <ul id="resultsList"></ul>
                    </div>
                </div>
                <div class="toolbar">
                    <button id="addMarkerBtn" class="btn">添加标记点</button>
                    <button id="connectMarkersBtn" class="btn">连接标记点</button>
                    <div class="dropdown">
                        <button id="exportDropdownBtn" class="btn dropdown-btn">导出路书 <span class="dropdown-arrow">▼</span></button>
                        <div id="exportDropdownContent" class="dropdown-content">
                            <button id="exportBtn" class="dropdown-item">导出JSON</button>
                            <button id="exportHtmlBtn" class="dropdown-item">导出HTML</button>
                        </div>
                    </div>
                    <button id="importBtn" class="btn">导入路书</button>
                    <button id="clearCacheBtn" class="btn">清除缓存</button>
                    <select id="mapSourceSelect" class="btn" style="background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.15)); color: #fff; border: 2px solid rgba(255,255,255,0.5); padding: 0.6rem 1.2rem; border-radius: 25px; font-size: 0.9rem; font-weight: 600; cursor: pointer;">
                        <option value="osm">OpenStreetMap</option>
                        <option value="satellite">ESRI影像图</option>
                        <option value="esri_street">ESRI街道图</option>
                        <option value="gaode">高德地图</option>
                        <option value="gaode_satellite">高德卫星图</option>
                        <option value="google">Google地图</option>
                        <option value="google_satellite">Google卫星图</option>
                        <option value="tencent">腾讯地图</option>
                    </select>
                    <input type="file" id="importFile" accept=".json,.html" style="display: none;">
                </div>
            </div>
        </header>

        <main>
            <div id="mapContainer" style="height: 100%; width: 100%;">
                <!-- 移动端菜单切换按钮 -->
                <button id="menuToggleBtn" class="menu-toggle-btn">☰</button>
                <!-- 地图和帮助控制按钮 -->
                <div class="map-controls">
                    <div id="dateRangePicker" class="date-range-picker" style="display: none;">
                        <input type="date" id="startDate">
                        <span>→</span>
                        <input type="date" id="endDate">
                        <button id="applyDateRangeFilter" class="btn">应用</button>
                    </div>
                    <button id="fitViewBtn" class="map-control-btn" title="调整视窗以显示所有元素">
                        🎯
                    </button>
                    <button id="helpBtn" class="help-btn" title="帮助">
                        ❓
                    </button>
                </div>
                <!-- 日期备注便签 -->
                <div id="dateNotesSticky" class="date-notes-sticky" style="display: none;">
                    <div class="date-notes-header">
                        <span id="dateNotesDate"></span>
                        <button id="closeDateNotesSticky" class="close-sticky-btn">×</button>
                    </div>
                    <div id="dateNotesContent" class="date-notes-content"></div>
                </div>
            </div>
            <!-- GitHub链接 - 经典角标，覆盖在右上角 -->
            <div class="github-corner">
                <a href="https://github.com/chenxuan520/roadbook" target="_blank" class="github-corner-link" title="GitHub" rel="noopener noreferrer">
                    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000000; color:#fff;" aria-hidden="true">
                        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
                        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
                        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
                    </svg>
                </a>
            </div>
            <div class="right-panel">
                <!-- 日程列表 -->
                <div class="sidebar" id="markerListPanel">
                    <div class="sidebar-header">
                        <h3>日程列表</h3>
                        <span class="filter-hint">📅 图标日期均可点</span>
                    </div>
                    <div id="markerList"></div>
                </div>
                <!-- 标记点详情面板 -->
                <div class="detail-panel" id="markerDetailPanel" style="display: none;">
                    <div class="detail-header">
                        <h3 id="detailTitle">标记点详情</h3>
                        <button class="close-btn" id="closeMarkerDetailBtn">&times;</button>
                    </div>
                    <div class="detail-content">
                        <div class="form-group">
                            <label>名称:</label>
                            <input type="text" id="markerNameInput" placeholder="输入标记点名称">
                        </div>
                        <div class="form-group">
                            <label>时间点:</label>
                            <div id="dateTimesContainer">
                                <!-- 时间点列表将在这里动态生成 -->
                            </div>
                            <button type="button" id="addDateTimeBtn" class="btn btn-secondary" style="margin-top: 0.5rem;">添加时间点</button>
                        </div>
                        <div class="form-group">
                            <label>坐标:</label>
                            <div id="markerCoords"></div>
                        </div>
                        <div class="form-group">
                            <label>标记点图标:</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div id="currentIconPreview" style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; border: 2px solid #667eea;"></div>
                                <button type="button" id="changeIconBtn" class="btn btn-secondary" style="margin: 0;">更换图标</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>标注内容:</label>
                            <textarea id="markerLabelsInput" rows="3" placeholder="输入标注内容，多个标注用分号隔开"></textarea>
                        </div>
                        <div class="detail-actions">
                            <button id="saveMarkerBtn" class="btn btn-primary">保存</button>
                            <button id="deleteMarkerBtn" class="btn btn-danger">删除</button>
                        </div>
                    </div>
                </div>
                <!-- 连接线详情面板 -->
                <div class="detail-panel" id="connectionDetailPanel" style="display: none;">
                    <div class="detail-header">
                        <h3 id="detailTitle">连接线详情</h3>
                        <button class="close-btn" id="closeConnectionDetailBtn">&times;</button>
                    </div>
                    <div class="detail-content">
                        <div class="form-group">
                            <label>时间:</label>
                            <input type="datetime-local" id="connectionDateInput">
                        </div>
                        <div class="form-group">
                            <label>耗时 (小时):</label>
                            <input type="number" id="connectionDuration" min="0" step="0.1" placeholder="请输入连接耗时（小时）">
                        </div>
                        <div class="form-group">
                            <label>起始标记点:</label>
                            <select id="connectionStartMarker"></select>
                        </div>
                        <div class="form-group">
                            <label>目标标记点:</label>
                            <select id="connectionEndMarker"></select>
                        </div>
                        <div class="form-group">
                            <label>交通方式:</label>
                            <div class="transport-buttons">
                                <button type="button" class="transport-btn" data-transport="car">
                                    <span class="icon">🚗</span>
                                    <span class="label">汽车</span>
                                </button>
                                <button type="button" class="transport-btn" data-transport="train">
                                    <span class="icon">🚄</span>
                                    <span class="label">火车</span>
                                </button>
                                <button type="button" class="transport-btn" data-transport="subway">
                                    <span class="icon">🚇</span>
                                    <span class="label">地铁</span>
                                </button>
                                <button type="button" class="transport-btn" data-transport="plane">
                                    <span class="icon">✈️</span>
                                    <span class="label">飞机</span>
                                </button>
                                <button type="button" class="transport-btn" data-transport="bus">
                                    <span class="icon">🚌</span>
                                    <span class="label">公交</span>
                                </button>
                                <button type="button" class="transport-btn" data-transport="cruise">
                                    <span class="icon">🚢</span>
                                    <span class="label">游轮</span>
                                </button>
                                <button type="button" class="transport-btn" data-transport="walk">
                                    <span class="icon">🚶</span>
                                    <span class="label">步行</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>标注内容:</label>
                            <textarea id="connectionLabelsInput" rows="3" placeholder="输入连接线标注内容"></textarea>
                        </div>
                        <div class="form-group">
                            <label>导航链接:</label>
                            <div class="navigation-links">
                                <a id="baiduNavLink" href="#" target="_blank" class="nav-link-btn">百度导航</a>
                                <a id="amapNavLink" href="#" target="_blank" class="nav-link-btn">高德导航</a>
                                <a id="qqNavLink" href="#" target="_blank" class="nav-link-btn">腾讯导航</a>
                                <a id="googleNavLink" href="#" target="_blank" class="nav-link-btn">Google导航</a>
                            </div>
                        </div>
                        <div class="form-group" id="ticketBookingSection" style="display: none;">
                            <label>购票服务:</label>
                            <div class="ticket-booking-links">
                                <a id="ctripTrainLink" href="#" target="_blank" class="nav-link-btn" style="display: none;">🚄 携程火车票</a>
                                <button id="planeTicketBtn" class="nav-link-btn" style="display: none;">✈️ 飞机票 (敬请期待)</button>
                            </div>
                        </div>
                        <div class="detail-actions">
                            <button id="saveConnectionBtn" class="btn btn-primary">保存</button>
                            <button id="deleteConnectionBtn" class="btn btn-danger">删除</button>
                        </div>
                    </div>
                </div>

                <!-- 日期详情面板 -->
                <div class="detail-panel" id="dateDetailPanel" style="display: none;">
                    <div class="detail-header">
                        <h3 id="dateDetailTitle">日期详情</h3>
                        <button class="close-btn" id="closeDateDetailBtn">&times;</button>
                    </div>
                    <div class="detail-content">
                        <div class="form-group">
                            <label>日期:</label>
                            <div id="dateDisplay"></div>
                        </div>
                        <div class="form-group">
                            <label>日期备注:</label>
                            <textarea id="dateNotesInput" rows="5" placeholder="请输入日期备注信息"></textarea>
                        </div>
                        <div class="detail-actions">
                            <button id="saveDateNotesBtn" class="btn btn-primary">保存备注</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 连接标记点模态框 -->
    <div id="connectModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>连接标记点</h3>
            <div class="form-group">
                <label>选择起始标记点:</label>
                <select id="startMarker"></select>
            </div>
            <div class="form-group">
                <label>选择目标标记点:</label>
                <select id="endMarker"></select>
            </div>
            <div class="form-group">
                <label>选择交通方式:</label>
                <div class="transport-buttons">
                    <button type="button" class="transport-btn active" data-transport="car">
                        <span class="icon">🚗</span>
                        <span class="label">汽车</span>
                    </button>
                    <button type="button" class="transport-btn" data-transport="train">
                        <span class="icon">🚄</span>
                        <span class="label">火车</span>
                    </button>
                    <button type="button" class="transport-btn" data-transport="subway">
                        <span class="icon">🚇</span>
                        <span class="label">地铁</span>
                    </button>
                    <button type="button" class="transport-btn" data-transport="plane">
                        <span class="icon">✈️</span>
                        <span class="label">飞机</span>
                    </button>
                    <button type="button" class="transport-btn" data-transport="bus">
                        <span class="icon">🚌</span>
                        <span class="label">公交</span>
                    </button>
                    <button type="button" class="transport-btn" data-transport="cruise">
                        <span class="icon">🚢</span>
                        <span class="label">游轮</span>
                    </button>
                    <button type="button" class="transport-btn" data-transport="walk">
                        <span class="icon">🚶</span>
                        <span class="label">步行</span>
                    </button>
                </div>
                <input type="hidden" id="transportType" value="car">
            </div>
            <button id="confirmConnect" class="btn">确认连接</button>
        </div>
    </div>

    <!-- 标记点图标选择模态框 -->
    <div id="iconModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="app.closeModals()">&times;</span>
            <h3>选择标记点图标</h3>
            <div class="icon-section">
                <h4>数字</h4>
                <div class="icon-grid">
                    <div class="icon-option" data-icon="0">
                        <div class="icon-preview" style="background-color: #667eea;">0</div>
                        <span>0</span>
                    </div>
                    <div class="icon-option" data-icon="1">
                        <div class="icon-preview" style="background-color: #667eea;">1</div>
                        <span>1</span>
                    </div>
                    <div class="icon-option" data-icon="2">
                        <div class="icon-preview" style="background-color: #667eea;">2</div>
                        <span>2</span>
                    </div>
                    <div class="icon-option" data-icon="3">
                        <div class="icon-preview" style="background-color: #667eea;">3</div>
                        <span>3</span>
                    </div>
                    <div class="icon-option" data-icon="4">
                        <div class="icon-preview" style="background-color: #667eea;">4</div>
                        <span>4</span>
                    </div>
                    <div class="icon-option" data-icon="5">
                        <div class="icon-preview" style="background-color: #667eea;">5</div>
                        <span>5</span>
                    </div>
                    <div class="icon-option" data-icon="6">
                        <div class="icon-preview" style="background-color: #667eea;">6</div>
                        <span>6</span>
                    </div>
                    <div class="icon-option" data-icon="7">
                        <div class="icon-preview" style="background-color: #667eea;">7</div>
                        <span>7</span>
                    </div>
                    <div class="icon-option" data-icon="8">
                        <div class="icon-preview" style="background-color: #667eea;">8</div>
                        <span>8</span>
                    </div>
                    <div class="icon-option" data-icon="9">
                        <div class="icon-preview" style="background-color: #667eea;">9</div>
                        <span>9</span>
                    </div>
                </div>
            </div>
            <div class="icon-section">
                <h4>图标</h4>
                <div class="icon-grid">
                    <div class="icon-option" data-icon="📍">
                        <div class="icon-preview" style="background-color: #667eea;">📍</div>
                        <span>标记</span>
                    </div>
                    <div class="icon-option" data-icon="🏠">
                        <div class="icon-preview" style="background-color: #FF5722;">🏠</div>
                        <span>家</span>
                    </div>
                    <div class="icon-option" data-icon="🏨">
                        <div class="icon-preview" style="background-color: #2196F3;">🏨</div>
                        <span>酒店</span>
                    </div>
                    <div class="icon-option" data-icon="🍽️">
                        <div class="icon-preview" style="background-color: #4CAF50;">🍽️</div>
                        <span>餐厅</span>
                    </div>
                    <div class="icon-option" data-icon="🏞️">
                        <div class="icon-preview" style="background-color: #FF9800;">🏞️</div>
                        <span>景点</span>
                    </div>
                    <div class="icon-option" data-icon="🛍️">
                        <div class="icon-preview" style="background-color: #9C27B0;">🛍️</div>
                        <span>购物</span>
                    </div>
                    <div class="icon-option" data-icon="🚉">
                        <div class="icon-preview" style="background-color: #607D8B;">🚉</div>
                        <span>交通</span>
                    </div>
                    <div class="icon-option" data-icon="🌳">
                        <div class="icon-preview" style="background-color: #8BC34A;">🌳</div>
                        <span>公园</span>
                    </div>
                    <div class="icon-option" data-icon="⛰️">
                        <div class="icon-preview" style="background-color: #795548;">⛰️</div>
                        <span>山峰</span>
                    </div>
                    <div class="icon-option" data-icon="🏖️">
                        <div class="icon-preview" style="background-color: #00BCD4;">🏖️</div>
                        <span>海滩</span>
                    </div>
                    <div class="icon-option" data-icon="📷">
                        <div class="icon-preview" style="background-color: #FF5722;">📷</div>
                        <span>拍照</span>
                    </div>
                    <div class="icon-option" data-icon="☕">
                        <div class="icon-preview" style="background-color: #795548;">☕</div>
                        <span>咖啡</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>自定义图标 (可选):</label>
                <input type="text" id="customIcon" placeholder="输入emoji或文字，如：🎯 或 A">
            </div>
            <div class="form-group">
                <label>图标颜色:</label>
                <input type="color" id="iconColor" value="#667eea">
            </div>
            <button id="confirmIcon" class="btn">确认选择</button>
        </div>
    </div>

    <!-- 帮助模态框 -->
    <div id="helpModal" class="modal">
        <div class="modal-content help-modal-content">
            <span class="close" id="closeHelp">&times;</span>
            <div class="help-header">
                <img src="favicon.png" alt="RoadbookMaker Logo" class="help-logo">
                <h2>RoadbookMaker - 帮助</h2>
            </div>
            <div class="help-content">
                <h3>项目介绍</h3>
                <p>RoadbookMaker是一个基于网页的地图标记和路线规划工具，允许用户在地图上添加标记点、连接路线，并导出分享您的行程规划。</p>
                <p>项目地址: <a href="https://github.com/chenxuan520/roadbook" target="_blank" rel="noopener noreferrer">GitHub - chenxuan520/roadbook</a></p>

                <h3>基本功能</h3>
                <ul>
                    <li><strong>添加标记点</strong> - 在地图上点击或使用快捷键 <kbd>A</kbd> 添加标记点</li>
                    <li><strong>连接标记点</strong> - 使用快捷键 <kbd>C</kbd> 连接两个标记点</li>
                    <li><strong>删除元素</strong> - 选中元素后使用快捷键 <kbd>D</kbd> 删除标记点或连接线</li>
                    <li><strong>自动调整视窗</strong> - 使用快捷键 <kbd>F</kbd> 自动调整视窗以显示所有元素</li>
                    <li><strong>拖拽移动</strong> - 点击并拖拽标记点来调整位置</li>
                    <li><strong>编辑详情</strong> - 点击标记点可查看和编辑详细信息</li>
                    <li><strong>查看帮助</strong> - 使用快捷键 <kbd>H</kbd> 或 <kbd>?</kbd> 打开帮助面板</li>
                    <li><strong>搜索框聚焦</strong> - 使用快捷键 <kbd>/</kbd> 聚焦到搜索框</li>
                    <li><strong>退出添加状态</strong> - 在添加标记点模式下按 <kbd>ESC</kbd> 键退出添加状态</li>
                    <li><strong>导入导出</strong> - 保存和加载路书数据</li>
                </ul>

                <h3>交通方式</h3>
                <p>支持多种交通方式连接标记点：</p>
                <ul>
                    <li>🚗 <strong>汽车</strong> - 自驾出行，红色连接线</li>
                    <li>🚄 <strong>火车</strong> - 铁路交通，蓝色连接线</li>
                    <li>🚇 <strong>地铁</strong> - 城市轨道交通，紫色连接线</li>
                    <li>✈️ <strong>飞机</strong> - 航空出行，绿色连接线</li>
                    <li>🚌 <strong>公交</strong> - 公共汽车，棕色连接线</li>
                    <li>🚢 <strong>游轮</strong> - 水上航行，青色连接线</li>
                    <li>🚶 <strong>步行</strong> - 步行路线，橙色连接线</li>
                </ul>

                <h3>快捷键</h3>
                <table class="shortcut-table">
                    <tr>
                        <td><kbd>A</kbd></td>
                        <td>添加标记点模式</td>
                    </tr>
                    <tr>
                        <td><kbd>C</kbd></td>
                        <td>打开连接标记点界面</td>
                    </tr>
                    <tr>
                        <td><kbd>D</kbd></td>
                        <td>删除选中的标记点或连接线</td>
                    </tr>
                    <tr>
                        <td><kbd>F</kbd></td>
                        <td>自动调整视窗以显示所有元素</td>
                    </tr>
                    <tr>
                        <td><kbd>H</kbd> 或 <kbd>?</kbd></td>
                        <td>显示帮助面板</td>
                    </tr>
                    <tr>
                        <td><kbd>/</kbd></td>
                        <td>聚焦到搜索框</td>
                    </tr>
                    <tr>
                        <td><kbd>Ctrl</kbd> + <kbd>Z</kbd></td>
                        <td>撤销上一步操作</td>
                    </tr>
                    <tr>
                        <td><kbd>ESC</kbd></td>
                        <td>退出添加标记点模式</td>
                    </tr>
                </table>

                <h3>详细使用说明</h3>

                <h4>🗺️ 地图操作</h4>
                <ul>
                    <li><strong>地图源切换</strong>：支持7种地图源，包括OpenStreetMap、高德地图、Google地图、ESRI影像图、腾讯地图等</li>
                    <li><strong>缩放和移动</strong>：鼠标滚轮缩放，拖拽移动地图</li>
                    <li><strong>自动定位</strong>：首次使用会自动获取您的位置（需要授权）</li>
                    <li><strong>视窗调整</strong>：按 <kbd>F</kbd> 键自动调整视窗显示所有标记点</li>
                </ul>

                <h4>📍 标记点管理</h4>
                <ol>
                    <li><strong>添加标记点</strong>：点击"添加标记点"按钮或按 <kbd>A</kbd> 键，然后在地图上点击</li>
                    <li><strong>编辑标记点</strong>：点击标记点打开详情面板，可修改标题、图标、时间、坐标等</li>
                    <li><strong>拖拽移动</strong>：直接拖拽标记点到新位置，连接线会自动更新</li>
                    <li><strong>删除标记点</strong>：选中标记点后按 <kbd>D</kbd> 键或点击删除按钮</li>
                    <li><strong>右键菜单</strong>：右键点击标记点可显示上下文菜单</li>
                    <li><strong>多时间点支持</strong>：每个标记点可设置多个时间点，支持按日期分组显示</li>
                    <li><strong>自定义图标</strong>：支持数字、emoji、自定义图标和颜色</li>
                </ol>

                <h4>🔗 连接线功能</h4>
                <ol>
                    <li><strong>创建连接</strong>：点击"连接标记点"按钮或按 <kbd>C</kbd> 键</li>
                    <li><strong>选择方式</strong>：在弹出的对话框中选择起始点和目标点</li>
                    <li><strong>交通方式</strong>：支持汽车、火车、地铁、飞机、公交、游轮、步行等多种方式</li>
                    <li><strong>连接线样式</strong>：每种交通方式有独特的颜色和图标</li>
                    <li><strong>详细信息</strong>：点击连接线可编辑标注、耗时、时间等信息</li>
                    <li><strong>导航集成</strong>：支持生成百度、高德、腾讯导航链接</li>
                </ol>

                <h4>🔍 搜索功能</h4>
                <ul>
                    <li><strong>智能搜索</strong>：在搜索框输入地点名称，支持实时搜索</li>
                    <li><strong>多搜索源</strong>：支持Photon、Nominatim、Overpass、百度地图、天地图等</li>
                    <li><strong>搜索方式</strong>：可手动选择搜索源或使用自动分配</li>
                    <li><strong>结果展示</strong>：搜索结果以下拉列表形式展示，点击可定位</li>
                    <li><strong>点击图标聚焦</strong>：点击搜索后在地图上出现的临时图标，可将视图聚焦到该点。</li>
                </ul>

                <h4>📅 日期和时间管理</h4>
                <ul>
                    <li><strong>时间规划</strong>：为每个标记点设置具体时间点</li>
                    <li><strong>多时间支持</strong>：单个标记点可设置多个时间点</li>
                    <li><strong>日期分组</strong>：标记点按日期自动分组显示</li>
                    <li><strong>日期筛选</strong>：支持按日期范围筛选显示标记点</li>
                    <li><strong>日期备注</strong>：可为特定日期添加备注说明</li>
                    <li><strong>时间线视图</strong>：在侧边栏按时间顺序显示所有标记点</li>
                </ul>

                <h4>💾 数据管理</h4>
                <ul>
                    <li><strong>本地存储</strong>：自动保存到浏览器本地存储，刷新不丢失</li>
                    <li><strong>JSON导入/导出</strong>：支持完整数据的导入导出，便于备份</li>
                    <li><strong>HTML导出</strong>：生成独立HTML文件，包含完整地图和数据</li>
                    <li><strong>分享功能</strong>：生成分享链接，他人可导入您的路书</li>
                    <li><strong>在线模式</strong>：支持云端保存和管理路书计划（需要登录）</li>
                </ul>

                <h4>⌨️ 快捷键系统</h4>
                <p>支持丰富的键盘快捷键，提高操作效率：</p>
                <ul>
                    <li><strong><kbd>A</kbd></strong> - 进入添加标记点模式</li>
                    <li><strong><kbd>C</kbd></strong> - 打开连接标记点对话框</li>
                    <li><strong><kbd>D</kbd></strong> - 删除选中的标记点或连接线</li>
                    <li><strong><kbd>F</kbd></strong> - 自动调整视窗显示所有元素</li>
                    <li><strong><kbd>H</kbd> 或 <kbd>?</kbd></strong> - 显示帮助面板</li>
                    <li><strong><kbd>/</kbd></strong> - 聚焦到搜索框</li>
                    <li><strong><kbd>ESC</kbd></strong> - 退出添加标记点模式</li>
                    <li><strong><kbd>Ctrl</kbd> + <kbd>Z</kbd></strong> - 撤销上一步操作</li>
                </ul>

                <h4>🌐 在线模式功能</h4>
                <ul>
                    <li><strong>用户认证</strong>：支持用户登录，JWT token认证</li>
                    <li><strong>云端保存</strong>：路书计划可保存到云端</li>
                    <li><strong>计划管理</strong>：支持创建、读取、更新、删除路书计划</li>
                    <li><strong>双击打开计划</strong>：在计划管理界面，双击任意计划项即可快速打开该计划。</li>
                    <li><strong>自动同步</strong>：在线模式下自动保存编辑内容</li>
                    <li><strong>内容检查</strong>：定期检查内容变化，提示保存状态</li>
                </ul>

                <h4>📱 移动端适配</h4>
                <ul>
                    <li><strong>设备检测</strong>：自动检测移动设备并提供相应提示</li>
                    <li><strong>响应式设计</strong>：界面适配不同屏幕尺寸</li>
                    <li><strong>触摸优化</strong>：支持触摸操作</li>
                </ul>

                <h4>🔧 高级功能</h4>
                <ul>
                    <li><strong>撤销重做</strong>：支持操作历史记录，可撤销多步操作</li>
                    <li><strong>坐标转换</strong>：自动处理中国地图坐标系转换</li>
                    <li><strong>距离计算</strong>：自动计算连接线距离</li>
                    <li><strong>导航集成</strong>：一键生成各种导航应用链接</li>
                    <li><strong>购票服务</strong>：当交通方式为火车或飞机时，可根据路线起终点实时查询并跳转到携程购票页面。</li>
                </ul>

                <h4>💡 使用技巧</h4>
                <ol>
                    <li><strong>快速开始</strong>：先添加几个标记点，然后用连接线串联起来</li>
                    <li><strong>时间规划</strong>：为标记点设置合理的时间，便于行程安排</li>
                    <li><strong>图标选择</strong>：使用emoji图标让标记点更直观</li>
                    <li><strong>颜色搭配</strong>：不同交通方式使用不同颜色，便于区分</li>
                    <li><strong>定期保存</strong>：虽然自动保存，但重要修改后建议手动导出备份</li>
                    <li><strong>分享协作</strong>：使用分享功能与他人协作编辑路书</li>
                </ol>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <script src="script.js"></script>
    <script src="html_export.js"></script>
    <script src="online_mode.js"></script>
    <script>
        // 添加提示信息以展示新功能
        document.addEventListener('DOMContentLoaded', function() {
            console.log('RoadbookMaker已加载，支持Ctrl+Z撤销功能');

            // Initialize the HTML exporter module
            if (typeof RoadbookHtmlExporter !== 'undefined' && window.app) {
                window.htmlExporter = new RoadbookHtmlExporter(window.app);

                // HTML导出按钮事件现在在script.js中统一处理
            }
        });
    </script>
</body>
</html>
